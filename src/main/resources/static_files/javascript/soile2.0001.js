var SOILE2;if(SOILE2!==undefined){throw new Error("SOILE2 already defined!")}SOILE2=(function(){var soile2={};var bin={},rt={},defs={},util={};soile2.defs=defs;soile2.rt=rt;soile2.bin=bin;soile2.util=util;bin.divide=function(x,y){if(_.isNumber(x)&&_.isNumber(y)){if(y===0){return Number.NaN}return(x/y)}return undefined};bin.eq=function(x,y){return _.isEqual(x,y)};bin.gt=function(){if(_.isNumber(x)&&_.isNumber(y)){return(x>y)}return false};bin.hide=function(id){id=soile2.util.getid(id);jQuery(id).addClass("hiddenelem")};bin.show=function(id){var args=Array.prototype.slice.call(arguments);var id,pos;if(args.length==2){id=soile2.util.getid(args[0]);pos=args[1]}else{if(args.length==1){id=soile2.util.getid(args[0])}}if(typeof id!=="undefined"){if(jQuery(id).length>0){jQuery(id).removeClass("hiddenelem");if(typeof pos!=="undefined"){soile2.bin.position(id,pos)}}}};bin.imagefile=function(id,url){var props={id:id,"class":"hiddenelem",src:url};jQuery("<img />",props).appendTo(soile2.util.getid("display"));return id};bin.position=function(){var arr=Array.prototype.slice.call(arguments);var id,top,left,args;if(arr.length<2){return}args=arr.splice(1);id=soile2.util.getid(arr[0]);if(args.length==1){if(typeof args[0]==="object"&&args[0].hasOwnProperty("top")&&args[0].hasOwnProperty("left")){top=args[0].top;left=args[0].left}}else{if(args.length>1){left=args[0];top=args[1]}}if(soile2.util.is_integer(top)&&soile2.util.is_integer(left)){jQuery(id).css({position:"absolute",top:soile2.util.to_integer(top),left:soile2.util.to_integer(left)})}};bin.lt=function(x,y){if(_.isNumber(x)&&_.isNumber(y)){return(x<y)}return false};bin.minus=function(){var nums=_.filter(_.toArray(arguments),_.isNumber);if(nums.length==0){return undefined}if(nums.length==1){return nums[0]}return(nums[0]+_.reduce(nums.slice(1),function(memo,num){return memo-num},0))};bin.multiply=function(){var nums=_.filter(_.toArray(arguments),_.isNumber);if(_.isEmpty(nums)){return undefined}return _.reduce(nums,function(memo,num){return memo*num},1)};bin.not=function(arg){return !(soile2.rt.truthvalue(arg))};bin.plus=function(){var nums=_.filter(_.toArray(arguments),_.isNumber);return _.reduce(nums,function(memo,num){return memo+num},0)};bin.recordts=function(){};bin.setstimuli=function(arr){if(jQuery.isArray(arr)){soile2.rt.stimuli=soile2.util.copyobject(arr);soile2.rt.stimuli.reverse()}};bin.stimulus=undefined;rt.finalize_defs=function(){soile2.rt.freeze(soile2.defs.gvars);soile2.rt.freeze(soile2.defs.vals);soile2.rt.freeze(soile2.defs.fns)};rt.freeze=(function(){if(Object.freeze!==undefined||typeof Object.freeze==="function"){return function(obj){return Object.freeze(obj)}}return function(obj){return obj}})();rt.truthvalue=function(value){if(value===false||value===null||value===undefined){return false}return true};rt.milliseconds=function(num){if(_.isNumber(num)){return Math.abs(num)}if(_.isString(num)){return Math.abs(parseInt(num,10))}return 0};rt.undefvar=function(name){var vars=soile2.defs.vars;if(vars.hasOwnProperty(name)){delete vars[name]}};rt.kbdlookup=function(){};rt.stimuli=[];rt.has_next_stimulus=function(){return(soile2.rt.stimuli.length>0)};rt.next_stimulus=function(){soile2.bin.stimulus=soile2.rt.stimuli.pop()};rt.clear_vars=function(){delete soile2.defs.vars;soile2.defs.vars={}};rt.reset_defs=function(){var reset=function(obj,name){if(obj.hasOwnProperty(name)){delete obj[name]}obj[name]={}};reset(soile2.defs,"gvars");reset(soile2.defs,"vals");reset(soile2.defs,"fns");reset(soile2.defs,"vars")};rt.opcodes=(function(){return soile2.rt.freeze({Eoc:-1,Assign:0,Fcall:1,If:2,While:3,Goto:4,Wait:5,Def:6,Undef:7})})();rt.get_pi=undefined;rt.reset_piarray=function(){soile2.rt.get_pi=function(idx){return null}};rt.set_piarray=function(piafunc){soile2.rt.get_pi=piafunc};rt.pi_opcode=function(pi){if(pi===undefined||pi===null){return -1}if(typeof pi!=="object"||pi.hasOwnProperty("opcode")===false){return -1}return pi.opcode};rt.pi_index=(function(){var index=0;return{get:function(){var current=index;index+=1;return current},set:function(i){index=i}}})();rt.exec_pi=function(){var opcodes=soile2.rt.opcodes;var dowait=false;var waitfor=0;var pi,opcode;while(true){pi=soile2.rt.get_pi(soile2.rt.pi_index.get());opcode=soile2.rt.pi_opcode(pi);if(opcode<0){break}if(opcode==opcodes.Assign){pi.host[pi.name]=(pi.value)();continue}else{if(opcode==opcodes.Fcall){(pi.host[pi.name]).apply(pi.host,pi.params());continue}else{if(opcode==opcodes.If){if(pi.cond.call({})===false){soile2.rt.pi_index.set(pi.jmp)}continue}else{if(opcode==opcodes.While){if((pi.cond)()===false){soile2.rt.pi_index.set(pi.jmp)}continue}else{if(opcode==opcodes.Goto){soile2.rt.pi_index.set(pi.jmp);continue}else{if(opcode==opcodes.Def){pi.func.call({},[]);continue}else{if(opcode==opcodes.Undef){soile2.rt.clear_vars();continue}}}}}}}if(opcode==opcodes.Wait){dowait=true;waitfor=pi.ms();break}}if(dowait){soile2.rt.pause_exec(waitfor);return}};rt.resume_exec=function(){soile2.rt.exec_pi()};rt.pause_exec=(function(){var MINDELAY=5;var due_ts;var timeout_id;var msleft=function(ts){return Math.abs(ts-soile2.rt.timestamp())};var keep_waiting=function(ts){return(msleft(ts)>MINDELAY)};var compute_delay=function(ts){var delay=msleft(ts);if(delay<10){return MINDELAY}if(delay<50){return MINDELAY*2}if(delay<100){return MINDELAY*5}if(delay<500){return MINDELAY*10}if(delay<1000){return MINDELAY*15}return MINDELAY*20};var scheduled=function(){if(keep_waiting(due_ts)===true){timeout_id=setTimeout(scheduled,compute_delay(due_ts));return}due_ts=-1;timeout_id=undefined;soile2.rt.resume_exec()};return function(ms){due_ts=soile2.rt.future_timestamp(ms);timeout_id=setTimeout(scheduled,compute_delay(due_ts))}})();rt.seal=(function(){if(Object.seal!==undefined||typeof Object.seal==="function"){return function(obj){return Object.seal(obj)}}return function(obj){return obj}})();rt.future_timestamp=function(ms){return(soile2.rt.timestamp()+ms)};rt.timestamp=(function(){if(Date.now!==undefined&&typeof Date.now=="function"){return function(){return Date.now()}}return function(){return(new Date()).getTime()}})();util.copyobject=function(oldObject){return JSON.parse(JSON.stringify(oldObject))};util.eval=function(code){jQuery.globalEval(code)};util.getid=function(s){if(typeof s==="string"){if(s.charAt(0)==="#"){return s}return"#".concat(s)}return s};util.is_integer=function(i){return _.isNumber(i)};util.to_integer=function(i){return parseInt(i,10)};return soile2})();